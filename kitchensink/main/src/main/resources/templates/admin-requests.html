<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Admin â€¢ Member Requests</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <style>
        :root{
          --bg1:#0f172a; --bg2:#1e293b; --card:rgba(255,255,255,.08); --border:rgba(255,255,255,.14);
          --text:#f1f5f9; --muted:#cbd5e1; --ok:#22c55e; --warn:#f59e0b; --err:#ef4444; --link:#60a5fa;
          color-scheme: dark light;
        }
        *{box-sizing:border-box}
        body{
          margin:0; min-height:100vh; color:var(--text);
          font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
          background:
            radial-gradient(1200px 800px at 10% 10%, #1f2937 0%, transparent 60%),
            radial-gradient(1000px 700px at 90% 20%, #111827 0%, transparent 55%),
            linear-gradient(160deg, var(--bg1), var(--bg2));
          padding:2rem; display:grid; gap:1.25rem; justify-items:center;
        }
        .container{ width:min(1100px,96vw); display:grid; gap:1rem }
        header{ display:flex; align-items:center; justify-content:space-between; gap:1rem }
        h1{ margin:0; font-size:1.35rem }
        .muted{ color:var(--muted) }

        .card{ background:var(--card); border:1px solid var(--border); border-radius:18px; padding:1rem; }
        table{ width:100%; border-collapse:separate; border-spacing:0 10px }
        thead th{ text-align:left; color:var(--muted); font-size:.9rem; padding:.25rem .5rem }
        tbody tr{ background:rgba(255,255,255,.06); border:1px solid var(--border); border-radius:12px }
        tbody td{ padding:.7rem .6rem; vertical-align:top }
        tbody tr td:first-child{ border-top-left-radius:12px; border-bottom-left-radius:12px }
        tbody tr td:last-child{ border-top-right-radius:12px; border-bottom-right-radius:12px }
        .btn{ border:0; border-radius:10px; padding:.6rem .9rem; font-weight:700; cursor:pointer }
        .approve{ background:linear-gradient(135deg,#16a34a,#22c55e); color:#fff }
        .reject{ background:linear-gradient(135deg,#d946ef,#ef4444); color:#fff }
        form{ display:inline }
        .small{ font-size:.9rem; color:var(--muted) }
        a{ color:var(--link); text-decoration:none }
        .alert{ padding:.7rem 1rem; border-radius:12px; border:1px solid var(--border); background:rgba(255,255,255,.06) }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>Member Requests</h1>
        <form th:action="@{/logout}" method="post" style="margin:0">
            <input type="hidden"
                   th:if="${_csrf != null}"
                   th:name="${_csrf.parameterName}"
                   th:value="${_csrf.token}"/>

            <button class="btn" type="submit"
                    style="background:rgba(255,255,255,.08); border:1px solid var(--border); color:var(--text);">Logout
            </button>
        </form>
    </header>

    <div th:if="${msg}" class="alert"><strong th:text="${msg}">Done.</strong></div>

    <section class="card">
        <table>
            <thead>
            <tr>
                <th>ID</th>
                <th>Member</th>
                <th>Type</th>
                <th>Submitted</th>
                <th>Details</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <tr th:if="${#lists.isEmpty(pending)}">
                <td colspan="6" class="small">No pending requests.</td>
            </tr>
            <tr th:each="r : ${pending}">
                <td th:text="${r.id}">id</td>
                <td>
                    <div th:text="${r.memberEmail}">email</div>
                    <div class="small" th:text="${r.before != null ? r.before.name : ''}">Name</div>
                </td>
                <td th:text="${r.type}">UPDATE</td>
                <td th:text="${#temporals.format(r.submittedAt, 'yyyy-MM-dd HH:mm')}">time</td>
                <td>
                    <div th:if="${r.type.name() == 'UPDATE'}">
                        <div class="small"><strong>Requested:</strong></div>
                        <ul class="small" style="margin:.25rem 0 0 1rem; padding:0;">
                            <li th:if="${r.requested?.name}" th:text="'name: ' + ${r.requested.name}">name</li>
                            <li th:if="${r.requested?.email}" th:text="'email: ' + ${r.requested.email}">email</li>
                            <li th:if="${r.requested?.phoneNumber}" th:text="'phone: ' + ${r.requested.phoneNumber}">
                                phone
                            </li>
                            <li th:if="${r.requested?.age != null}" th:text="'age: ' + ${r.requested.age}">age</li>
                            <li th:if="${r.requested?.place}" th:text="'place: ' + ${r.requested.place}">place</li>
                        </ul>
                    </div>
                    <div th:if="${r.type.name() == 'DELETE'}" class="small">Account deletion requested</div>
                </td>
                <td>
                    <form th:action="@{'/admin/requests/' + ${r.id} + '/approve'}" method="post">
                        <input type="hidden"
                               th:if="${_csrf != null}"
                               th:name="${_csrf.parameterName}"
                               th:value="${_csrf.token}"/>

                        <button class="btn approve" type="submit">Approve</button>
                    </form>
                    <br> </br>
                    <form th:action="@{'/admin/requests/' + ${r.id} + '/reject'}" method="post"
                          style="margin-top:.35rem">
                        <input type="hidden"
                               th:if="${_csrf != null}"
                               th:name="${_csrf.parameterName}"
                               th:value="${_csrf.token}"/>

                        <button class="btn reject" type="submit">Reject</button>
                        <br> </br>
                        <input name="reason" type="text" placeholder="Reason (optional)"
                               style="width:100%; margin-bottom:.35rem; padding:.4rem .55rem; border-radius:8px; border:1px solid var(--border); background:rgba(255,255,255,.06); color:var(--text)">
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </section>
</div>
</body>
</html>
