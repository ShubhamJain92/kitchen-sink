<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Set a new password</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root {
          --bg1: #0f172a;          /* slate-900 */
          --bg2: #1e293b;          /* slate-800 */
          --card: rgba(255,255,255,0.08);
          --border: rgba(255,255,255,0.14);
          --text: #f1f5f9;         /* slate-100 */
          --muted: #cbd5e1;        /* slate-300 */
          --brand: #7c3aed;        /* violet-600 */
          --ok: #22c55e;           /* green-500 */
          --warn: #f59e0b;         /* amber-500 */
          --bad: #ef4444;          /* red-500 */
          --link: #60a5fa;         /* blue-400 */
          color-scheme: dark light;
        }
        * { box-sizing: border-box; }
        body {
          margin: 0; min-height: 100vh;
          font: 16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
          color: var(--text);
          background:
            radial-gradient(1200px 800px at 10% 10%, #1f2937 0%, transparent 60%),
            radial-gradient(1000px 700px at 90% 20%, #111827 0%, transparent 55%),
            linear-gradient(160deg, var(--bg1), var(--bg2));
          display: grid; place-items: center; padding: 2rem;
        }
        .card {
          width: min(520px, 96vw);
          background: backdrop-filter: blur(12px);
          background-color: var(--card);
          border: 1px solid var(--border);
          border-radius: 18px;
          padding: 1.25rem 1.25rem 1.5rem;
          box-shadow: 0 10px 30px rgba(0,0,0,.2);
          backdrop-filter: blur(10px);
        }
        header {
          display: flex; align-items: center; gap: .75rem; margin-bottom: 1rem;
        }
        .logo {
          width: 40px; height: 40px; border-radius: 12px;
          background: linear-gradient(135deg, var(--brand), #06b6d4);
          display: grid; place-items: center; color: white; font-weight: 800;
          box-shadow: 0 6px 20px rgba(124,58,237,.35);
          letter-spacing: .5px;
        }
        h1 { font-size: 1.25rem; margin: 0; }
        p.muted { color: var(--muted); margin: .25rem 0 0; font-size: .95rem; }
        form { display: grid; gap: .9rem; margin-top: .5rem; }
        label { font-weight: 600; font-size: .95rem; }
        .field {
          position: relative; display: grid; gap: .4rem;
        }
        input[type="password"], input[type="text"] {
          background: rgba(255,255,255,.06);
          border: 1px solid var(--border);
          border-radius: 12px;
          padding: .8rem 3rem .8rem .9rem;
          color: var(--text); outline: none; width: 100%;
        }
        input:focus {
          border-color: rgba(124,58,237,.7);
          box-shadow: 0 0 0 3px rgba(124,58,237,.25);
        }
        .toggle {
          position: absolute; right: .5rem; top: 2.55rem;
          background: transparent; border: 0; color: var(--muted);
          cursor: pointer; padding: .4rem; border-radius: 8px;
        }
        .hint { color: var(--muted); font-size: .9rem; }
        .meter {
          height: 10px; border-radius: 999px; overflow: hidden;
          background: rgba(255,255,255,.08); border: 1px solid var(--border);
        }
        .bar {
          height: 100%; width: 0%; transition: width .25s ease, background .25s ease;
          background: var(--bad);
        }
        .req { display: grid; gap: .25rem; font-size: .9rem; color: var(--muted); margin-top: .25rem; }
        .req .ok { color: var(--ok); }
        .row { display: grid; gap: .35rem; }
        .actions { display: flex; gap: .6rem; align-items: center; margin-top: .2rem; }
        .btn {
          appearance: none; border: 0; border-radius: 12px; padding: .8rem 1rem;
          font-weight: 700; cursor: pointer;
        }
        .btn-primary {
          background: linear-gradient(135deg, var(--brand), #06b6d4);
          color: white; box-shadow: 0 8px 18px rgba(124,58,237,.35);
        }
        .btn:disabled { opacity: .6; cursor: not-allowed; box-shadow: none; }
        .link { color: var(--link); text-decoration: none; }
        .alert {
          padding: .75rem 1rem; border-radius: 12px; margin: .5rem 0 1rem;
          border: 1px solid var(--border); background: rgba(255,255,255,.06);
        }
        .alert.error { border-color: rgba(239,68,68,.4); background: rgba(239,68,68,.08); }
        .alert.ok    { border-color: rgba(34,197,94,.4); background: rgba(34,197,94,.08); }
        small.error { color: var(--bad); }
    </style>
</head>
<body>

<div class="card">
    <header>
        <div class="logo">KS</div>
        <div>
            <h1>Update your password</h1>
            <p class="muted">For security, choose a strong, unique password.</p>
        </div>
    </header>

    <!-- optional server-side messages -->
    <div th:if="${param.error}" class="alert error" th:text="${param.error}">Something went wrong.</div>
    <div th:if="${param.msg}" class="alert ok" th:text="${param.msg}">Password updated.</div>

    <form th:action="@{/reset-password}" method="post" id="pwdForm" novalidate>
        <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

        <div class="field">
            <label for="newPassword">New password</label>
            <input id="newPassword" name="newPassword" type="password" autocomplete="new-password" required>
            <button class="toggle" type="button" aria-label="Show password" onclick="toggle('newPassword', this)">üëÅÔ∏è</button>

            <!-- strength meter -->
            <div class="meter" aria-hidden="true"><div id="bar" class="bar"></div></div>
            <div class="req" id="reqList">
                <span id="rLen">‚Ä¢ At least 8 characters</span>
                <span id="rCase">‚Ä¢ Upper & lower case</span>
                <span id="rNum">‚Ä¢ At least one number</span>
                <span id="rSym">‚Ä¢ At least one symbol (@#$%^&* etc.)</span>
            </div>
        </div>

        <div class="field">
            <label for="confirmPassword">Confirm password</label>
            <input id="confirmPassword" name="confirmPassword" type="password" autocomplete="new-password" required>
            <button class="toggle" type="button" aria-label="Show password" onclick="toggle('confirmPassword', this)">üëÅÔ∏è</button>
            <small id="mismatch" class="error" style="display:none;">Passwords do not match.</small>
        </div>

        <div class="actions">
            <button class="btn btn-primary" id="submitBtn" type="submit" disabled>Update password</button>
            <a href="/" class="link">Cancel</a>
        </div>

        <p class="hint">Tip: Don‚Äôt reuse a password from another site.</p>
    </form>
</div>

<script>
    const newPwd = document.getElementById('newPassword');
    const cfmPwd = document.getElementById('confirmPassword');
    const bar    = document.getElementById('bar');
    const btn    = document.getElementById('submitBtn');
    const mismatch = document.getElementById('mismatch');
    const rLen = document.getElementById('rLen');
    const rCase = document.getElementById('rCase');
    const rNum = document.getElementById('rNum');
    const rSym = document.getElementById('rSym');

    function toggle(id, el) {
      const inp = document.getElementById(id);
      const isPass = inp.type === 'password';
      inp.type = isPass ? 'text' : 'password';
      el.textContent = isPass ? 'üôà' : 'üëÅÔ∏è';
      el.setAttribute('aria-label', isPass ? 'Hide password' : 'Show password');
    }

    function score(pwd) {
      let s = 0;
      const hasLen  = pwd.length >= 8;
      const hasLow  = /[a-z]/.test(pwd);
      const hasUp   = /[A-Z]/.test(pwd);
      const hasNum  = /\d/.test(pwd);
      const hasSym  = /[^A-Za-z0-9]/.test(pwd);

      // update requirement ticks
      setReq(rLen, hasLen);
      setReq(rCase, hasLow && hasUp);
      setReq(rNum, hasNum);
      setReq(rSym, hasSym);

      s += hasLen ? 1 : 0;
      s += (hasLow && hasUp) ? 1 : 0;
      s += hasNum ? 1 : 0;
      s += hasSym ? 1 : 0;

      return s; // 0..4
    }

    function setReq(el, ok) {
      el.className = ok ? 'ok' : '';
      el.textContent = (ok ? '‚úì ' : '‚Ä¢ ') + el.textContent.replace(/^(\u2713\s|‚Ä¢\s)/, '');
    }

    function updateUI() {
      const s = score(newPwd.value);
      const match = newPwd.value && newPwd.value === cfmPwd.value;
      mismatch.style.display = match || !cfmPwd.value ? 'none' : 'inline';

      const pct = (s / 4) * 100;
      bar.style.width = pct + '%';
      bar.style.background = s >= 3 ? 'var(--ok)' : (s === 2 ? 'var(--warn)' : 'var(--bad)');

      // enable only if strong enough & matches
      btn.disabled = !(s >= 3 && match);
    }

    newPwd.addEventListener('input', updateUI);
    cfmPwd.addEventListener('input', updateUI);
    window.addEventListener('load', updateUI);
</script>
</body>
</html>
